!function e(t,o,i){function n(c,r){if(!o[c]){if(!t[c]){var a="function"==typeof require&&require;if(!r&&a)return a(c,!0);if(s)return s(c,!0);var d=new Error("Cannot find module '"+c+"'");throw d.code="MODULE_NOT_FOUND",d}var l=o[c]={exports:{}};t[c][0].call(l.exports,function(e){var o=t[c][1][e];return n(o?o:e)},l,l.exports,e,t,o,i)}return o[c].exports}for(var s="function"==typeof require&&require,c=0;c<i.length;c++)n(i[c]);return n}({1:[function(e,t,o){"use strict";var i=["$window","$stateParams","$scope","$timeout","$element","$interval","$document","telemetry"],n=function(e,t,o,i,n,s,c,r){var a=this;r.debug("Wedding/WeddingMoments is being loaded"),a.__=e._,a._telemetry=r,a._scope=o,a._timeout=i,a._element=n,a._interval=s,a._document=c,a._window=e,a._scope.activeMoment={item:a._scope.weddingMoments.messages[0]},a._scope.momentItemSelected=a.momentItemSelected.bind(a),a._scope.closeLightbox=a.closeLightbox.bind(a),a._scope.likeMedia=a.likeMedia.bind(a),a._scope.unlikeMedia=a.unlikeMedia.bind(a),a._scope.postMomentComment=a.postMomentComment.bind(a),a._scope.deleteMomentComment=a.deleteMomentComment.bind(a),a._scope.getActiveLikes=a.getActiveLikes.bind(a),a._scope.getActiveComments=a.getActiveComments.bind(a),a._scope.$watch("activeMoment.item",function(e){e&&a._document[0].getElementById("gr"+e.$key)&&a.scrollTimeline(e)}),a._checkMomentPermalink(t.moment);var d=o.$on("$stateChangeSuccess",function(){a._checkMomentPermalink(t.moment)});o.$on("$destroy",function(){d()})};n.prototype._checkMomentPermalink=function(e){var t=this;void 0!==e&&t._telemetry.debug("Try to show moment "+e+" in the lightbox, otherwise redirect to moments.")},n.prototype.momentItemSelected=function(e,t){var o=this;o._scope.lightboxVisible=!0,o._scope.activeMoment.item=t,o._scope.$emit("lightboxOpen"),o._telemetry.event({category:"wedding.moments",action:"LightboxOpen",label:t.$key})},n.prototype.closeLightbox=function(){var e=this;e._scope.lightboxVisible=!1,e._scope.$emit("lightboxClose"),e._telemetry.event({category:"wedding.moments",action:"LightboxClose"})},n.prototype.scrollTimeline=function(e){var t=this,o=e.$key,i=t._document[0].getElementById("gr"+o).parentNode,n=i.getBoundingClientRect().left,s=i.getBoundingClientRect().right,c=t._window.angular.element(t._element.children()[0]),r=c.scrollLeft(),a=(n+s)/2+r-t._window.innerWidth/2;c.scrollLeft(a,1e3)},n.prototype.likeMedia=function(e,t){var o=this;1==t?(o._scope.engagementMomentLiked({moment:e}),o._telemetry.event({category:"wedding.moments",action:"LikeAdd",label:"moment.engagement"})):2==t?(o._scope.weddingMomentLiked({moment:e}),o._telemetry.event({category:"wedding.moments",action:"LikeAdd",label:"moment.wedding"})):o._telemetry.debug("group indiscernible: "+t)},n.prototype.unlikeMedia=function(e,t){var o=this;1===t?(o._scope.engagementMomentUnliked({moment:e}),o._telemetry.event({category:"wedding.moments",action:"LikeRemove",label:"moment.engagement"})):2===t?(o._scope.weddingMomentUnliked({moment:e}),o._telemetry.event({category:"wedding.moments",action:"LikeRemove",label:"moment.wedding"})):o._telemetry.debug("group indiscernible: "+t)},n.prototype.postMomentComment=function(e,t,o){var i=this;1==o?(i._scope.engagementMomentCommentPosted({momentId:e,comment:t}),i._telemetry.event({category:"wedding.moments",action:"CommentAdd",label:"moment.engagement"})):2==o?(i._scope.weddingMomentCommentPosted({momentId:e,comment:t}),i._telemetry.event({category:"wedding.moments",action:"CommentAdd",label:"moment.wedding"})):i._telemetry.debug("group indiscernible: "+o)},n.prototype.deleteMomentComment=function(e,t,o){var i=this;1==o?(i._scope.engagementMomentCommentDeleted({momentId:e,commentId:t}),i._telemetry.event({category:"wedding.moments",action:"CommentRemove",label:"moment.engagement"})):2==o?(i._scope.weddingMomentCommentDeleted({momentId:e,commentId:t}),i._telemetry.event({category:"wedding.moments",action:"CommentRemove",label:"moment.wedding"})):i._telemetry.debug("group indiscernible: "+o)},n.prototype.getActiveLikes=function(e,t,o){var i=this;1==t?i._scope.engagementMomentLikeListWanted({momentId:e,callback:o}):2==t?i._scope.weddingMomentLikeListWanted({momentId:e,callback:o}):i._telemetry.debug("group indiscernible: "+t)},n.prototype.getActiveComments=function(e,t,o){var i=this;1==t?i._scope.engagementMomentCommentListWanted({momentId:e,cursor:null,count:null,callback:o}):2==t?i._scope.weddingMomentCommentListWanted({momentId:e,cursor:null,count:null,callback:o}):i._telemetry.debug("group indiscernible: "+t)},i.push(n),t.exports=function(){return{restrict:"E",scope:{weddingInfo:"=",weddingTheme:"=",engagementMoments:"=",weddingMoments:"=",weddingMomentLiked:"&",weddingMomentUnliked:"&",engagementMomentLiked:"&",engagementMomentUnliked:"&",engagementMomentLikeListWanted:"&",weddingMomentLikeListWanted:"&",engagementMomentCommentListWanted:"&",weddingMomentCommentListWanted:"&",engagementMomentCommentPosted:"&",weddingMomentCommentPosted:"&",engagementMomentCommentDeleted:"&",weddingMomentCommentDeleted:"&",user:"="},templateUrl:"/pages/wedding/weddingMoments/weddingMoments.html",controller:i}}},{}],2:[function(e,t,o){"use strict";var i=function(t){t.directive("countdown",e("../widgets/countdown/countdown")),t.directive("countdownTimer",e("../widgets/countdownTimer/countdownTimer")),t.directive("dragScrollable",e("../widgets/dragScrollable/dragScrollable")),t.directive("horizontalGrid",e("../widgets/horizontalGrid/horizontalGrid")),t.directive("infoPanel",e("../widgets/infoPanel/infoPanel")),t.directive("lightbox",e("../widgets/lightbox/lightbox")),t.directive("lightboxItem",e("../widgets/lightboxItem/lightboxItem")),t.directive("placeBackground",e("../widgets/placeBackground/placeBackground"))};o=t.exports=i},{"../widgets/countdown/countdown":4,"../widgets/countdownTimer/countdownTimer":5,"../widgets/dragScrollable/dragScrollable":6,"../widgets/horizontalGrid/horizontalGrid":7,"../widgets/infoPanel/infoPanel":8,"../widgets/lightbox/lightbox":9,"../widgets/lightboxItem/lightboxItem":10,"../widgets/placeBackground/placeBackground":11}],3:[function(e,t,o){(function(t){"use strict";var o=t.angular,i=o.module("joy");i.directive("weddingMoments",e("../pages/wedding/weddingMoments/weddingMoments")),e("./_widgetsWedding")(i)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../pages/wedding/weddingMoments/weddingMoments":1,"./_widgetsWedding":2}],4:[function(e,t,o){"use strict";var i=function(e,t,o,i){var n=this;i.debug("countdown directive is being loaded"),n._scope=e,n._location=t,n._filter=o,e.subtitle="",e.tapped=function(){i.event("Widget","Countdown_Tapped",e.route,e.referrer,{eventDate:e.eventDate}),e.onRedirect()},e.swiped=function(){i.event("Widget","Countdown_Swiped",e.route,e.referrer,{eventDate:e.eventDate}),e.onSwipe()},e.$watch("eventDate",function(){var t=Math.floor((e.eventDate-Date.now())/864e5*1);t>1?e.subtitle="Till our special day - "+o("prettyDateFilter")(e.eventDate):t<-1?e.subtitle="special day - "+o("prettyDateFilter")(e.eventDate):t>=-1&&t<=1&&(e.subtitle="Is our special day")})};t.exports=function(){return{restrict:"E",scope:{referrer:"=",route:"=",eventDate:"=",onRedirect:"&",onSwipe:"&"},templateUrl:"/widgets/countdown/countdown.html",controller:["$scope","$location","$filter","telemetry",i]}}},{}],5:[function(e,t,o){"use strict";var i=function(e,t,o,i,n,s){var c=this;if(s.debug("countdownTimer directive is being loaded"),c._scope=e,c._timeout=t,c._window=i,c._interval=n,isNaN(Number(c._scope.targetTime)))return void s.warn("The given targetTime is not a valid millisecond value: "+c._scope.targetTime);if(c._scope.comparisonTime&&isNaN(Number(c._scope.comparisonTime)))return void s.warn("This given compareTo is not a valid millisecond value: "+c._scope.compareTo);c._scope.liveCountdownPromise=void 0,c._scope.horizontal=c._scope.horizontal||null;var r=864e5,a=36e5,d=6e4,l=1e3,p=function(){c._scope.compareTo=c._scope.comparisonTime||Date.now();var e=Math.abs(c._scope.targetTime-c._scope.compareTo);c._scope.daysRemaining=Math.floor(e/r),c._scope.hoursRemaining=Math.floor(e%r/a),c._scope.minutesRemaining=Math.floor(e%r%a/d),c._scope.secondsRemaining=Math.floor(e%r%a%d/l),0!==c._scope.daysRemaining&&1!==c._scope.daysRemaining||c.checkUpcoming()};void 0===c._scope.liveCountdownPromise&&(c._scope.liveCountdownPromise=c._interval(p,1e3)),c._scope.$on("$destroy",function(){c.cancelCountdown()})};i.prototype.checkUpcoming=function(){var e=this,t=new Date(Number(e._scope.targetTime)),o=new Date(e._scope.compareTo);t.getFullYear()===o.getFullYear()&&t.getMonth()===o.getMonth()&&(t.getDate()===o.getDate()?(e._scope.message="Today",e.cancelCountdown()):t.getDate()-o.getDate()===1&&(e._scope.message="Tomorrow",e.cancelCountdown()))},i.prototype.cancelCountdown=function(){var e=this;void 0!==e._scope.liveCountdownPromise&&e._interval.cancel(e._scope.liveCountdownPromise)},t.exports=function(){return{restrict:"E",scope:{targetTime:"@",comparisonTime:"@",horizontal:"@",units:"@"},templateUrl:"/widgets/countdownTimer/countdownTimer.html",controller:["$scope","$timeout","$element","$window","$interval","telemetry",i]}}},{}],6:[function(e,t,o){"use strict";var i=function(e,t,o){var i=this;o.debug("dragScrollable directive is being loaded"),i._scope=e,i._element=t};t.exports=function(){return{restrict:"A",scope:{referrer:"=",route:"=",edgeResistance:"@",type:"@"},link:function(e,t){Draggable.create(t,{type:e.type||"scrollLeft",edgeResistance:e.edgeResistance||1,throwProps:!0})},controller:["$scope","$element","telemetry",i]}}},{}],7:[function(e,t,o){"use strict";var i=function(e,t,o,i,n){var s=this;n.debug("horizontalGrid directive is being loaded"),s._telemetry=n,s._scope=e,s._timeout=t,s._element=o,s._window=i,s._scope.border=2,s._scope.templateHistory=[],s._scope.itemSets=[],s._scope.gridItemIndex=0,s._scope.templateStyles=[{type:"singleCol",style:"single",sequenceCount:1},{type:"singleCol",style:"double",sequenceCount:2},{type:"singleCol",style:"triple",sequenceCount:3},{type:"singleCol",style:"quad",sequenceCount:4},{type:"splitCol",style:"tripleSplitTop",sequenceCount:4},{type:"splitCol",style:"tripleSplitMiddle",sequenceCount:4},{type:"splitCol",style:"tripleSplitBottom",sequenceCount:4}],s._scope.gridManagementCount=0,s._scope.addItem=s.addItem.bind(s),s._scope.onItemClick=s.onItemClick.bind(s),s._scope.clickHeart=s.clickHeart.bind(s),s.setScrollbarHeight=s.setScrollbarHeight.bind(s),s.applyMomentsTimeout=!1;var c=s._scope.$on(s._scope.eventListener,function(){s.applyMomentsTimeout&&s._timeout.cancel(s.applyMomentsTimeout),s.applyMomentsTimeout=s._timeout(function(){s._timeout(function(){s.initLayout()}),s._timeout(function(){s.updateGridWidth()})},0,!1)}),r=s._window.angular.element(s._window);r.bind("resize",function(){s._scope.$apply(function(){s.initLayout()}),s.updateGridWidth()}),s._scope.$on("$destroy",function(){r.off("resize"),c()}),s._scrollbarHeight=0,s._timeout(function(){s.initLayout(),s._scope.$digest()},0,!1),s._timeout(function(){s.updateGridWidth(),s._scope.$digest()},0,!1)};i.prototype.setScrollbarHeight=function(){var e=this,t=e._window.document.createElement("div");t.className="scrollbar-measure",e._window.document.body.appendChild(t),e._scrollbarHeight=t.offsetHeight-t.clientHeight,e._telemetry.debug("Scroll bar on: "+e._scrollbarHeight),e._window.document.body.removeChild(t)},i.prototype.initLayout=function(){var e=this,t=0;0===e._scrollbarHeight&&(e.setScrollbarHeight(),t=e._scrollbarHeight);var o=e._element[0].getBoundingClientRect().height-1-t;e.gridManager(o)},i.prototype.updateGridWidth=function(){var e=this;if(e._element.children().length>0){var t=e._element.children()[0].getBoundingClientRect().left,o=e._element.children()[e._element.children().length-1].getBoundingClientRect().right;e._scope.gridWidth=o-t,e._element[0].style.width=e._scope.gridWidth+"px"}},i.prototype.addItem=function(){var e=this;e._scope.onAddItem()},i.prototype.onItemClick=function(e,t){e.stopPropagation();var o=this;o._scope.onItemSelected({event:e,item:t})},i.prototype.templatePicker=function(e,t){for(var o,i,n=[],s=0;s<e.length;s++)i="image"===e[s].type&&e[s].asset.getOriginalMetadata()||null,"text"===e[s].type?n.push("vert"):i.width===i.height?n.push("sq"):i.width>i.height?n.push("horiz"):i.width<i.height&&n.push("vert");var c=n.filter(function(e){return"vert"==e}).length;return t>3&&"sq"===n[0]&&"sq"===n[1]&&c<2?o=4:t>3&&"sq"===n[1]&&"sq"===n[2]&&c<2?o=5:t>3&&"sq"===n[2]&&"sq"===n[3]&&c<2?o=6:t>3&&c<3?o=Math.floor(2*Math.random())+2:t>=3?o=Math.floor(2*Math.random())+1:2===t?o=1:1===t&&(o=0),o},i.prototype.gridManager=function(e){var t=this;t._scope.gridManagementCount=t._scope.gridManagementCount+1,t._scope.itemSets=[],t._scope.gridItemIndex=0;for(var o,i,n,s=t._scope.gridItems,c=0,r=[],a=0,d=[];s.length-a>0;){d=[],d=s.slice(a,a+6);var l=t._scope.itemSets.length;switch(c>=t._scope.templateHistory.length||c===t._scope.templateHistory.length-1&&t._scope.templateHistory[c].sequenceCount<4?(n=t.templatePicker(d,s.length-a),i=t._scope.templateStyles[n]):i=t._scope.templateHistory[c],i.style){case"single":case"double":case"triple":case"quad":for(var p=0;p<i.sequenceCount;++p)t._scope.itemSets.push([t._scope.gridItems[t._scope.gridItemIndex+p]]);o=t.getSingleColW(d.slice(0,i.sequenceCount),e);break;case"tripleSplitTop":t._scope.itemSets.push([t._scope.gridItems[t._scope.gridItemIndex],t._scope.gridItems[t._scope.gridItemIndex+1]],[t._scope.gridItems[t._scope.gridItemIndex+2]],[t._scope.gridItems[t._scope.gridItemIndex+3]]),o=t.getSplitColW(d.slice(0,i.sequenceCount),e,l);break;case"tripleSplitMiddle":t._scope.itemSets.push([t._scope.gridItems[t._scope.gridItemIndex]],[t._scope.gridItems[t._scope.gridItemIndex+1],t._scope.gridItems[t._scope.gridItemIndex+2]],[t._scope.gridItems[t._scope.gridItemIndex+3]]),o=t.getSplitColW(d.slice(0,i.sequenceCount),e,l);break;case"tripleSplitBottom":t._scope.itemSets.push([t._scope.gridItems[t._scope.gridItemIndex]],[t._scope.gridItems[t._scope.gridItemIndex+1]],[t._scope.gridItems[t._scope.gridItemIndex+2],t._scope.gridItems[t._scope.gridItemIndex+3]]),o=t.getSplitColW(d.slice(0,i.sequenceCount),e,l)}t.setSequenceWidth(d.slice(0,i.sequenceCount),o,l),r.push(i),t._scope.gridItemIndex+=i.sequenceCount,a+=i.sequenceCount,c++}t._scope.templateHistory=r},i.prototype.getSingleColW=function(e,t){for(var o,i,n,s,c=this,r=0,a=0;a<e.length;a++)o=e[a],i="image"===o.type&&o.asset.getOriginalMetadata()||null,null!==i&&i.height&&i.width?(n=i.height,s=i.width):"text"===o.type&&(n=500,s=400),r+=n/s;return c._telemetry.event({category:"widget.horizontalGrid",action:"SingleColumnPresented"}),t/r},i.prototype.getSplitColW=function(e,t,o){for(var i,n,s,c,r=this,a=0,d=0,l=o;l<r._scope.itemSets.length;l++)for(var p=0;p<r._scope.itemSets[l].length;p++)i=e[d],n="image"===i.type&&i.asset.getOriginalMetadata()||null,null!==n&&n.height&&n.width?(s=n.width,c=n.height,1===r._scope.itemSets[l].length?a+=c/s:2===r._scope.itemSets[l].length&&0===p&&(a+=c/(2*s))):"text"===i.type&&(s=400,c=500,a+=c/s),d++;return r._telemetry.event({category:"widget.horizontalGrid",action:"DoubleColumnPresented"}),t/a},i.prototype.setSequenceWidth=function(e,t,o){for(var i,n,s,c,r=this,a=0,d=o;d<r._scope.itemSets.length;d++)for(var l=0;l<r._scope.itemSets[d].length;l++)i=e[a],n="image"===i.type&&i.asset.getOriginalMetadata()||null,s=n&&n.width||400,c=n&&n.height||500,1==r._scope.itemSets[d].length?(r._scope.itemSets[d][l].resizedHeight=t*c/s,r._scope.itemSets[d][l].resizedWidth=t):2==r._scope.itemSets[d].length&&(r._scope.itemSets[d][l].resizedHeight=t*c/(2*s),r._scope.itemSets[d][l].resizedWidth=t/2),a++},i.prototype.clickHeart=function(e,t){var o=this;t?o._scope.mediaUnliked({media:e}):o._scope.mediaLiked({media:e})},t.exports=function(){return{restrict:"E",scope:{gridItems:"=",referrer:"=",route:"=",onAddItem:"&",onItemSelected:"&",colorTheme:"=",mediaLiked:"&",mediaUnliked:"&",eventListener:"@"},templateUrl:"/widgets/horizontalGrid/horizontalGrid.html",controller:["$scope","$timeout","$element","$window","telemetry",i]}}},{}],8:[function(e,t,o){"use strict";var i=function(e,t,o,i,n,s){var c=this;n.debug("infoPanel directive is being loaded"),c._scope=e,c._location=t,c._filter=o,c._timeout=i,c._document=s,c._telemetry=n,c._scope.toggleInfoPanel=c.toggleInfoPanel.bind(c),c._scope.postComment=c.postComment.bind(c),c._scope.deleteComment=c.deleteComment.bind(c),c._scope.textAreaFocus=c.textAreaFocus.bind(c),c._scope.likeMedia=c.likeMedia.bind(c),c._scope.activePanel="comments",c._scope.commentString="",c._scope.$watch("activePanel",function(e){c._scope.activePanel=e}),c._scope.$watch("isLoved",function(e){c._scope.loved=e})};i.prototype.textAreaFocus=function(e){var t=this;t._scope.$emit("infoPanelTextAreaFocus",e)},i.prototype.toggleInfoPanel=function(e){var t=this;t._scope.activePanel=e,t._telemetry.event({category:"widget.infoPanel",action:"InfopanelToggle",label:e})},i.prototype.likeMedia=function(){var e=this;e._scope.disabled||(e._scope.loved?(e._scope.loved=!1,e._scope.mediaLiked({like:!1})):(e._scope.loved=!0,e._scope.mediaLiked({like:!0})))},i.prototype.postComment=function(){var e=this,t=e._scope.commentString;t.length>0&&t.length<750?(e._scope.commentPosted({comment:e._scope.commentString,user:e._scope.user}),e._timeout(function(){e._scope.commentString="",e._scope.$emit("infoPanelTextAreaBlur")})):t.length>=750?e._telemetry.event({category:"widget.infoPanel",action:"longcomment",value:t.length}):e._telemetry.event({category:"widget.infoPanel",action:"nocomment"})},i.prototype.deleteComment=function(e){var t=this;t._scope.commentDeleted({commentId:e})},t.exports=function(){return{restrict:"E",scope:{referrer:"=",route:"=",activePanel:"=",colorTheme:"=",caption:"@",composer:"@",composerAvatar:"@",timestamp:"=",isLoved:"=",loveList:"=",commentsList:"=",commentPosted:"&",commentDeleted:"&",mediaLiked:"&",visible:"=",user:"=",activeMediaId:"=",disabled:"="},link:function(e,t,o,i){var n=t[0].getElementsByClassName("comments-container"),s=!0,c=e.user.id,r=function(){i._timeout(function(){(s||n[0].scrollTop==n[0].scrollHeight||e.commentsList[e.commentsList.length-1].creatorId==c)&&(n[0].scrollTop=n[0].scrollHeight,s&&(s=!1),e.$digest())},100,!1)};e.$watch("visible",function(e){e&&r()}),e.$watch("commentsList",function(t){t&&e.visible&&t.length>0&&r()}),e.$watch("activeMediaId",function(){s=!0,r()})},templateUrl:"/widgets/infoPanel/infoPanel.html",controller:["$scope","$location","$filter","$timeout","telemetry","$document",i]}}},{}],9:[function(e,t,o){"use strict";var i=function(e,t,o,i,n,s,c,r,a){var d=this;a.debug("lightbox directive is being loaded"),d._telemetry=a,d._scope=e,d._location=t,d._filter=o,d._window=i,d._document=n,d._interval=s,d._sce=c,d._timeout=r,d._scope.weddingTheme={baseBackground:{},baseTextColor:{}},d._scope.windowResize=d.windowResize.bind(d),d._scope.nextItem=d.nextItem.bind(d),d._scope.previousItem=d.previousItem.bind(d),d._scope.hideSecondary=d.hideSecondary.bind(d),d._scope.love=d.love.bind(d),d._scope.launchLove=d.launchLove.bind(d),d._scope.launchComment=d.launchComment.bind(d),d._scope.play=d.play.bind(d),d._scope.startSlideshow=d.startSlideshow.bind(d),d._scope.stopSlideshow=d.stopSlideshow.bind(d),d._scope.postComment=d.postComment.bind(d),d._scope.deleteComment=d.deleteComment.bind(d),d._scope.requestLikes=d.requestLikes.bind(d),d._scope.closeLightbox=d.closeLightbox.bind(d),d._scope.activeSecondaryPanel="comments",d._scope.media=[],d._scope.media.push.apply(d._scope.media,d._scope.mediaItems1),d._scope.media.push.apply(d._scope.media,d._scope.mediaItems2),d._scope.activeMedia={},d._previousClicked=!1,d._scope.$watchCollection("mediaItems1",function(e){d._scope.media=[],d._scope.media.push.apply(d._scope.media,e),d._scope.media.push.apply(d._scope.media,d._scope.mediaItems2)}),d._scope.$watchCollection("mediaItems2",function(e){d._scope.media=[],d._scope.media.push.apply(d._scope.media,d._scope.mediaItems1),d._scope.media.push.apply(d._scope.media,e)});var l=d._window.angular.element(d._window);l.bind("resize",function(){d._timeout(function(){d._scope.windowResize()})}),d._scope.$watch("showSecondary",function(e){void 0!==e&&d._scope.windowResize()}),d._scope.$watch("lightboxVisible",function(e){e===!0&&d._timeout(function(){d._scope.windowResize()},0,!1),e===!1&&d._scope.stopSlideshow()});var p=function(){var e=function(e){return Math.floor(255*e)};return function(t){return"string"==typeof t?t:"rgba("+t.slice(0,3).map(e).join(",")+","+t[3]+")"}}(),m=function(){var e=d._scope.colorTheme||{};d._scope.weddingTheme.baseBackground["background-color"]=p(e.baseColor),d._scope.weddingTheme.baseTextColor.color=p(e.baseText)};["colorTheme"].forEach(function(e){["baseColor","baseText"].forEach(function(t){d._scope.$watch(e+"."+t,function(){m()})})}),d._scope.$watch("activeMedia",function(e){d._scope.activeMedia=e,d._scope.requestLikes(e.$key,e.mediaGroup),d.requestComments(e.$key,e.mediaGroup)},!0)};i.prototype.windowResize=function(){var e=this,t=function(){var t,o;e._scope.showSecondary===!0?(t=e._document[0].getElementById("joy-lightbox-media-container"),o=t.offsetWidth,o+=(o+1)%2):(t=e._window,o=t.innerWidth,o+=(o+1)%2);var i=e._window.innerHeight;i+=(i+1)%2;var n=o/i;return[o,i,n]},o=function(e){var t=e.offsetWidth,o=e.offsetHeight;return[t,o]},i=function(e){var t;return"image"==e.type&&e.asset.getOriginalMetadata().height&&e.asset.getOriginalMetadata().width?(t=e.asset.getOriginalMetadata().width/e.asset.getOriginalMetadata().height,[e.asset.getOriginalMetadata().width,e.asset.getOriginalMetadata().height,t]):"video"===e.type?[1e4,1e4,16/9]:[1e5,1e5,1]},n=function(e,t,o){var i,n,s=.8*e[0],c=.8*e[1];return t[1]>c?(n=c,i=c*t[2],i>=s&&(i=s,n=s/t[2])):t[0]>=s?(i=s,n=s/t[2],n>c&&(n=c,i=c*t[2])):(t[0]<=s||t[1]<=c)&&(i=t[0],n=t[1]),i=Math.floor(i),n=Math.floor(n),i+=(i+1)%2,n+=(n+1)%2,o.width=i,o.height=n,[i,n]},s=function(e,t,o,i,n,s){e.style.width=t+"px",e.style.height=o+"px",e.style.top=(n-o)/2+"px",e.style.bottom=(n-o)/2+"px",e.style.left=(i-t)/2+"px",e.style.right=(i-t)/2+s/2+"px"},c=function(e,t,o,i,n,s){e.style.width=t+"px",e.style.height=o+"px",e.style.top=(n-o)/2+"px",e.style.bottom=(n-o)/2+"px",e.style.left=(i-t)/2+"px",e.style.right=(i-t)/2+s/2+"px"},r=function(e,t,o,i,n,s){e.setAttribute("style","left:"+(n+o)/2+"px;height:"+i+"px;top:"+(s-i)/2+"px;"),t.setAttribute("style","right:"+(n+o)/2+"px;height:"+i+"px;top:"+(s-i)/2+"px;")},a=[0,0],d=e._document[0].getElementById("joy-lightbox-frame"),l=e._document[0].getElementById("joy-lightbox-next-button"),p=e._document[0].getElementById("joy-lightbox-prev-button");if(e._document[0].getElementById("joy-lightbox-secondary")){var m=e._document[0].getElementById("joy-lightbox-secondary");a=o(m)}var u=e._document[0].getElementById("joy-lightbox-media-container"),g=t();u.style.width=g[0],u.style.height=g[1];for(var _=0;_<e._scope.media.length;_++){var h="joy"+e._scope.media[_].$key,f=e._document[0].getElementById(h),v=i(e._scope.media[_]),y=n(g,v,f);"image"===e._scope.media[_].type&&c(f,y[0],y[1],g[0],g[1],a[0]),h=="joy"+e._scope.activeMedia.$key&&(s(d,y[0],y[1],g[0],g[1],a[0]),r(l,p,y[0],y[1],g[0],g[1]))}},i.prototype.closeLightbox=function(){var e=this;e._scope.playingSlideshow&&e._scope.stopSlideshow(),e._scope.close()},i.prototype.hideSecondary=function(){var e=this;e._scope.showSecondary=!1,e._timeout(function(){e._scope.windowResize(),e._scope.$digest()},0,!1)},i.prototype.love=function(e){var t=this,o=t._scope.activeMedia;e?t._scope.mediaLiked({media:o,group:o.mediaGroup}):t._scope.mediaUnliked({media:o,group:o.mediaGroup})},i.prototype.postComment=function(e,t){var o=this;o._scope.postMomentComment({momentId:o._scope.activeMedia.$key,comment:e,group:o._scope.activeMedia.mediaGroup}),o._scope.activeMedia.comments.push({$key:"pendingMoment",caption:e,creator:{displayName:t.displayName,getAvatarUrl:function(){return t.avatarUrl}},creatorId:"",timestamp:"",type:"text"})},i.prototype.deleteComment=function(e){var t=this;t._scope.deletedMomentComment({momentId:t._scope.activeMedia.$key,commentId:e,group:t._scope.activeMedia.mediaGroup});for(var o=t._scope.activeMedia.comments.length,i=0;i<o;i++)if(t._scope.activeMedia.comments[i].$key==e){t._scope.activeMedia.comments.splice(i,1);break}},i.prototype.launchLove=function(){var e=this;if(!e._scope.disabled){if(e._scope.showSecondary)return void e._timeout(function(){e._scope.showSecondary=!1});e._scope.showSecondary=!0,e._scope.activeSecondaryPanel="loves",e._timeout(function(){e._scope.windowResize(),e._scope.$digest()},0,!1)}},i.prototype.launchComment=function(){var e=this;if(!e._scope.disabled){if(e._scope.showSecondary)return void e._timeout(function(){e._scope.showSecondary=!1,e._scope.$digest()},0,!1);e._scope.showSecondary=!0,e._scope.activeSecondaryPanel="comments",e._timeout(function(){e._scope.windowResize(),e._scope.$digest()},0,!1)}},i.prototype.nextItem=function(){for(var e=this,t=0;t<e._scope.media.length;t++)if(e._scope.media[t].$key==e._scope.activeMedia.$key){if(t+1<e._scope.media.length?e._scope.activeMedia=e._scope.media[t+1]:e._scope.activeMedia=e._scope.media[0],e._scope.windowResize(),e._scope.slideshowTimer){var o=e._timeout.cancel(e._scope.slideshowTimer);o&&e.startSlideshow()}else e._telemetry.event({category:"widget.lightbox",action:"GoToNextItem"});return}},i.prototype.previousItem=function(){for(var e=this,t=0;t<e._scope.media.length;t++)if(e._scope.media[t].$key==e._scope.activeMedia.$key)return t-1>=0?e._scope.activeMedia=e._scope.media[t-1]:e._scope.activeMedia=e._scope.media[e._scope.media.length-1],e._scope.windowResize(),void(e._scope.playingSlideshow&&e._scope.slideshowTimer?(e._timeout.cancel(e._scope.slideshowTimer),e._previousClicked=!0,e.startSlideshow()):e._telemetry.event({category:"widget.lightbox",action:"GoToPreviousItem"}))},i.prototype.play=function(){var e=this,t=4e3;e._previousClicked?e._previousClicked=!1:e._scope.nextItem(),e._scope.playingSlideshow&&e._scope.lightboxVisible&&(e._scope.slideshowTimer=e._timeout(function(){e.play()},t))},i.prototype.startSlideshow=function(){var e=this;e._scope.playingSlideshow=!0,e._scope.play(),e._telemetry.event({category:"widget.lightbox",action:"SlideshowStart"})},i.prototype.stopSlideshow=function(){var e=this;e._timeout.cancel(e._scope.slideshowTimer),e._scope.playingSlideshow=!1,e._telemetry.event({category:"widget.lightbox",action:"SlideshowStop"})},i.prototype.requestLikes=function(e,t){var o=this;o._scope.getActiveLikes({momentId:e,group:t,callback:function(e,t){e?o._telemetry.error(e):o._timeout(function(){o._scope.activeMedia.likesList=t,o._scope.$digest()},0,!1)}})},i.prototype.requestComments=function(e,t){var o=this;o._scope.getActiveComments({momentId:e,group:t,callback:function(e,t){e?o._telemetry.error(e):o._timeout(function(){o._scope.activeMedia.comments=t.comments,o._scope.$digest()},0,!1)}})},t.exports=function(){return{restrict:"E",scope:{referrer:"=",route:"=",close:"&",lightboxVisible:"=",colorTheme:"=",mediaItems1:"=",mediaItems2:"=",activeMedia:"=",mediaLiked:"&",mediaUnliked:"&",postMomentComment:"&",deletedMomentComment:"&",getActiveLikes:"&",getActiveComments:"&",disabled:"=",user:"="},link:function(e,t,o,i){var n=!0;e.$watch(o.lightboxVisible,function(e){e&&i._timeout(function(){t[0].focus()})});var s=e.$on("homeMenuClose",function(){o.lightboxVisible&&i._timeout(function(){t[0].focus()})}),c=i._scope.$on("infoPanelTextAreaBlur",function(){n=!0,i._timeout(function(){t[0].focus()})});t.on("click",function(e){"TEXTAREA"==e.target.nodeName?n=!1:i._timeout(function(){n=!0,t[0].focus()})}),t.on("keydown",function(t){if(o.lightboxVisible&&n){switch(t.which||t.keyCode){case 39:e.$apply(function(){e.nextItem()});break;case 37:e.$apply(function(){e.previousItem()});break;case 32:e.playingSlideshow?e.$apply(function(){e.stopSlideshow()}):e.$apply(function(){e.startSlideshow()});break;case 27:e.$apply(function(){e.closeLightbox()});break;default:return}t.preventDefault()}}),e.$on("$destroy",function(){t.off("keydown"),s(),c()})},templateUrl:"/widgets/lightbox/lightbox.html",controller:["$scope","$location","$filter","$window","$document","$interval","$sce","$timeout","telemetry",i]}}},{}],10:[function(e,t,o){"use strict";var i=function(e,t,o){var i=this;i._scope=e,i._location=t,i._filter=o,i._scope.clickHeart=i.clickHeart.bind(i),i._scope.imageWidth>i._scope.imageHeight?i._scope.imageSizing="auto 100%":i._scope.imageSizing="100% auto",i._scope.$watch("isLoved",function(e){i._scope.loved=e})};i.prototype.clickHeart=function(){var e=this;e._scope.disabled||(e._scope.loved?(e._scope.loved=!1,e._scope.clickLove({like:!1,id:e._scope.itemId,group:e._scope.group})):(e._scope.loved=!0,e._scope.clickLove({like:!0,id:e._scope.itemId,group:e._scope.group})))},t.exports=function(){return{restrict:"E",scope:{type:"@",src1:"@",src2:"@",height:"@",width:"@",composer:"@",composerAvatar:"@",caption:"@",loves:"=",comments:"=",clickMedia:"&",clickLove:"&",clickLoveCount:"&",clickComment:"&",colorTheme:"=",itemId:"@",imageWidth:"@",imageHeight:"@",isLoved:"=",group:"=",disabled:"="},templateUrl:"/widgets/lightboxItem/lightboxItem.html",controller:["$scope","$location","$filter","telemetry",i]}}},{}],11:[function(e,t,o){"use strict";var i=function(e,t,o,i,n){var s=this;i.debug("placeBackground directive is being loaded"),s._scope=e,s._timeout=t,s._scope.assets=o,s._unsplashService=n,s._scope.cityBgs=[{place:"Los Angeles, California",background:s._scope.assets.statesLosAngelesCalifornia01},{place:"New York, New York",background:s._scope.assets.statesNewYorkNewYork},{place:"San Francisco, California",background:s._scope.assets.statesSanFranciscoCalifornia}],s._scope.stateBgs=[],s._scope.placeholderBg=s._scope.assets.statesNowhereNowhere04JoyMainPhoto,s.watchUpdates()};i.prototype.watchUpdates=function(){var e=this;void 0!==e._scope.input?e._scope.$watch("input",function(t,o){t===o?e._scope.placeBgUrl=e._unsplashService.getPhotoForId(e._scope.input):e._timeout(function(){e._scope.placeBgUrl=e._unsplashService.getPhotoForId(e._scope.input)},5e3)}):e._scope.$watch("place",function(t){e._scope.placeBgUrl=null,t&&(e._scope.placeBgUrl=e.findBackground()),e._scope.placeBgUrl||e._scope.strict||(e._scope.placeBgUrl=e._scope.placeholderBg)})},i.prototype.findBackground=function(){var e=this,t=e._scope.place.split(" ").slice(-1)[0],o=e._scope.cityBgs.filter(function(t){return t.place===e._scope.place})[0]||e._scope.stateBgs.filter(function(e){return e.place===t})[0]||null;return o&&o.background||null},t.exports=function(){return{restrict:"A",scope:{place:"@",input:"@",placeBgUrl:"=",strict:"=?"},controller:["$scope","$timeout","assets","telemetry","unsplashService",i]}}},{}]},{},[3]);